angular.module("autoService",["ngRoute","ui.bootstrap"]).config(["$routeProvider","$locationProvider","$httpProvider",function(e,t,n){n.defaults.headers.get={"X-Frame-Options":"DENY"},e.when("/",{templateUrl:"frontPage/frontPage.view.html",controller:"frontPageCtrl",controllerAs:"vm"}).when("/services",{templateUrl:"services/services.view.html",controller:"servicesCtrl",controllerAs:"vm"}).when("/inventory",{templateUrl:"inventory/inventory.view.html",controller:"inventoryCtrl",controllerAs:"vm"}).when("/inventory/form",{templateUrl:"inventoryForm/inventoryForm.view.html",controller:"inventoryFormCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/registration",{templateUrl:"/auth/registration/registration.view.html",controller:"registrationCtrl",controllerAs:"vm"}).when("/contact",{templateUrl:"contact/contact.view.html",controller:"contactCtrl",controllerAs:"vm"}).when("/db",{templateUrl:"dbPage/dbPage.view.html",controller:"dbPageCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"}),t.html5Mode(!0),t.hashPrefix("")}]),function(){function e(n,o){return{services:function(e){return e?n.get("/api/services?page="+e,{headers:{Authorization:"Bearer "+o.returnToken()}}):n.get("/api/services",{headers:{Authorization:"Bearer "+o.returnToken()}})},serviceDelete:function(e){return n.delete("/api/services/"+e,{headers:{Authorization:"Bearer "+o.returnToken()}})},addNew:function(e){return n.post("/api/services",e,{headers:{Authorization:"Bearer "+o.returnToken()}})},update:function(e,t){return n.put("/api/services/"+e,t,{headers:{Authorization:"Bearer "+o.returnToken()}})}}}e.$inject=["$http","authentication"],angular.module("autoService").service("serviceData",e)}(),function(){function e(n,t,e,o){var r=this;r.title="Services",r.msg="Searching sevices...",r.error="",r.deleteService=function(e,t){n.serviceDelete(e).then(function(e){r.data.services.splice(t,1),r.msg="Service deleted successfully",setTimeout(function(){r.msg=""},3e3)},function(e){r.msg="Delete failed.",setTimeout(function(){r.msg=""},3e3),console.log(e.e)})},r.serviceFormModal=function(e){t.open({templateUrl:"/serviceForm/serviceForm.view.html",controller:"serviceFormCtrl",controllerAs:"vm",resolve:{serviceDetails:function(){return e}}}).result.then(function(e){void 0!==e&&(e.update?(r.msg="Service updated successfully",setTimeout(function(){r.msg=""},3e3)):(r.msg="Service added successfully",setTimeout(function(){r.msg=""},3e3),r.data.services.push(e.data)))},function(e){r.msg="Napaka: "+e})},r.goToNextPage=function(){n.services(r.data.nextPage).then(function(e){r.msg=0<e.data.docs.length?"":"No data in services.",r.data={services:e.data.docs,nextPage:e.data.nextPage,prevPage:e.data.prevPage}},function(e){r.msg="An error occured when fetching data from services.",console.log(e.e)})},r.goToPrevPage=function(){n.services(r.data.prevPage).then(function(e){r.msg=0<e.data.docs.length?"":"No data in services.",r.data={services:e.data.docs,nextPage:e.data.nextPage,prevPage:e.data.prevPage}},function(e){r.msg="An error occured when fetching data from services.",console.log(e.e)})},r.logedin=function(){return e.logedin()},n.services().then(function(e){r.msg=0<e.data.docs.length?"":"No services.",r.data={services:e.data.docs,nextPage:e.data.nextPage,prevPage:e.data.prevPage}},function(e){r.msg="Error while fetching services.",console.log(e.e)}),o.log("service")}e.$inject=["serviceData","$uibModal","authentication","audit"],angular.module("autoService").controller("servicesCtrl",e)}(),function(){function e(e,t,n,o){var r=this;r.title="Services",r.msg="Searching sevices...",r.data=void 0===n?{firstName:"",lastName:"",email:"",phoneNumber:"",time:"",type:""}:n,r.modalnoOkno={preklici:function(){t.close()}},r.saveData=function(){console.log(r.data),void 0===r.data._id?e.addNew(r.data).then(function(e){console.log(e),t.close({data:e.data,update:!1})},function(e){r.msg="Delete failed.",console.log(e.e)}):e.update(r.data._id,r.data).then(function(e){console.log(e),t.close({data:e.data,update:!0})},function(e){r.msg="Delete failed.",console.log(e.e)})},o.log("serviceForm")}e.$inject=["serviceData","$uibModalInstance","serviceDetails","audit"],angular.module("autoService").controller("serviceFormCtrl",e)}(),function(){function e(n,t,e){var o=this;o.title="Inventory",o.msg="Searching inventory data...",o.searchText="",o.search=function(){o.data.inventory=o.data.allInventory.filter(function(e){return e.itemName.includes(o.searchText)})},o.deleteInventory=function(e,t){n.inventoryDelete(e).then(function(e){o.msg="Item deleted successfully",setTimeout(function(){o.msg=""},3e3),o.data.inventory.splice(t,1)},function(e){o.msg="Failed to delete",console.log(e.e)})},o.inventoryFormModal=function(e){t.open({templateUrl:"/inventoryForm/inventoryForm.view.html",controller:"inventoryFormCtrl",controllerAs:"vm",resolve:{inventoryDetails:function(){return e}}}).result.then(function(e){void 0!==e&&(e.update?(o.msg="Item updated successfully",setTimeout(function(){o.msg=""},3e3)):(o.msg="Item added successfully",setTimeout(function(){o.msg=""},3e3),o.data.inventory.push(e.data)))},function(e){})},o.goToNextPage=function(){n.inventory(o.data.nextPage).then(function(e){o.msg=0<e.data.docs.length?"":"No data in inventory.",o.data={allInventory:e.data.docs,inventory:e.data.docs,nextPage:e.data.nextPage,prevPage:e.data.prevPage}},function(e){o.msg="An error occured when fetching data from inventory.",console.log(e.e)})},o.goToPrevPage=function(){n.inventory(o.data.prevPage).then(function(e){o.msg=0<e.data.docs.length?"":"No data in inventory.",o.data={allInventory:e.data.docs,inventory:e.data.docs,nextPage:e.data.nextPage,prevPage:e.data.prevPage}},function(e){o.msg="An error occured when fetching data from inventory.",console.log(e.e)})},n.inventory().then(function(e){console.log(e),o.msg=0<e.data.docs.length?"":"No data in inventory.",o.data={allInventory:e.data.docs,inventory:e.data.docs,nextPage:e.data.nextPage,prevPage:e.data.prevPage}},function(e){o.msg="An error occured when fetching data from inventory.",console.log(e.e)}),e.log("inventory")}e.$inject=["inventoryData","$uibModal","audit"],angular.module("autoService").controller("inventoryCtrl",e)}(),angular.module("autoService").controller("frontPageCtrl",function(){this.title="Welcome",this.msg="Loading FrontPage",this.error=""}),function(){function e(e){var t=this;t.msg="",t.error="",t.text="",e.log("contact"),t.sendMessage=function(){e.sendMessage(t.text).then(function(e){t.msg="Message send successfully"},function(e){t.msg="Failed to send message."})}}e.$inject=["audit"],angular.module("autoService").controller("contactCtrl",e)}(),function(){function e(e,t){var n=this;n.title="Db",n.msg="",n.error="",n.deleteAll=function(){e.dbDelete().then(function(){n.msg="Db deleted sucessfully",setTimeout(function(){n.msg=""},3e3)},function(){n.msg="Failed to delete"})},n.loadPresets=function(){e.dbAdd().then(n.msg="Db loaded sucessfully")}}e.$inject=["dbData","$uibModal"],angular.module("autoService").controller("dbPageCtrl",e)}(),function(){function e(n,o){return{inventory:function(e){return console.log(e),e?n.get("/api/inventory?page="+e,{headers:{Authorization:"Bearer "+o.returnToken()}}):n.get("/api/inventory",{headers:{Authorization:"Bearer "+o.returnToken()}})},inventoryDelete:function(e){return n.delete("/api/inventory/"+e,{headers:{Authorization:"Bearer "+o.returnToken()}})},addNew:function(e){return n.post("/api/inventory",e,{headers:{Authorization:"Bearer "+o.returnToken()}})},update:function(e,t){return console.log("test"),n.put("/api/inventory/"+e,t,{headers:{Authorization:"Bearer "+o.returnToken()}})}}}e.$inject=["$http","authentication"],angular.module("autoService").service("inventoryData",e)}(),function(){function e(t,n){return{log:function(e){return data={time:Date.now(),user:n.logedin()?JSON.stringify(n.currUser()):"Guest",page:e},t.post("/api/audit",data)},sendMessage:function(e){return t.post("/api/bot",{text:e})}}}e.$inject=["$http","authentication"],angular.module("autoService").service("audit",e)}(),function(){function e(e,t,n,o){var r=this;r.title="Inventory",r.msg="Searching inventory...",r.data=n||{itemName:"",description:"",quantity:""},r.modalnoOkno={preklici:function(){t.close()}},r.saveData=function(){console.log(r.data),void 0===r.data._id?e.addNew(r.data).then(function(e){console.log(e),t.close({data:e.data,update:!1})},function(e){r.msg="Delete failed.",console.log(e.e)}):e.update(r.data._id,r.data).then(function(e){console.log(e),t.close({data:e.data,update:!0})},function(e){r.msg="Delete failed.",console.log(e.e)})},o.log("inventoryForm")}e.$inject=["inventoryData","$uibModalInstance","inventoryDetails","audit"],angular.module("autoService").controller("inventoryFormCtrl",e)}(),function(){function e(n,t){var o=function(e){n.localStorage["autoService-token"]=e},r=function(){return n.localStorage["autoService-token"]},a=function(){var e=r();return!!e&&JSON.parse(n.atob(e.split(".")[1])).validityDate>Date.now()/1e3};return{storeToken:o,returnToken:r,registration:function(e){return t.post("/api/register",e).then(function(e){o(e.data.token)})},login:function(e){return t.post("/api/login",e).then(function(e){o(e.data.token)})},logout:function(){n.localStorage.removeItem("autoService-token")},logedin:a,currUser:function(){if(a()){var e=r(),t=JSON.parse(n.atob(e.split(".")[1]));return{mail:t.mail,name:t.name}}}}}e.$inject=["$window","$http"],angular.module("autoService").service("authentication",e)}(),function(){function e(t,e,n){var o=this;o.registerData={name:"",mail:"",pass:"",admin:!1},o.firstToDisplay=t.search().page||"/",o.sendContent=function(){if(o.error="",!(o.registerData.name&&o.registerData.mail&&o.registerData.pass))return!(o.error="Enter all the data!");o.register()},o.register=function(){o.error="",e.registration(o.registerData).then(function(e){t.search("login",null),t.path(o.firstToDisplay)},function(e){o.error=e.data})},n.log("registration")}e.$inject=["$location","authentication","audit"],angular.module("autoService").controller("registrationCtrl",e)}(),function(){function e(e,t,n){var o=this;o.loginData={mail:"",pass:""},o.error="",o.sendContent=function(){if(o.error="",!o.loginData.mail||!o.loginData.pass)return!(o.error="All data required.");o.login()},o.login=function(){o.error="",console.log(o.loginData),e.login(o.loginData).then(function(e){console.log("dela",e),t.path("/inventory")},function(e){o.error=e.data})},n.log("login")}e.$inject=["authentication","$location","audit"],angular.module("autoService").controller("loginCtrl",e)}(),function(){var e=function(e){return this.logedin=function(){return e.logedin()},{restrict:"EA",templateUrl:"/all/directives/nav/nav.template.html"}};e.$inject=["authentication"],angular.module("autoService").directive("naviga",e)}(),function(){function e(e){return{db:function(){return e.get("/api/db")},dbDelete:function(){return e.delete("/api/db")},dbAdd:function(){return e.post("/api/db")}}}e.$inject=["$http"],angular.module("autoService").service("dbData",e)}();